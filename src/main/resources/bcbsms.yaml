a:
    operation: loadpage
b:
    operation: execute_js
    javascriptOperator: |
        var callback = arguments[arguments.length - 1];
        var url = 'https://www.bcbsms.com/BlueLand/rx/rxDirectFormularyDrugSearch.do?method=autocomplete&memberId=&drugName=Otezla';
        xhttp = new XMLHttpRequest();
        xhttp.open('GET', url, false);
        xhttp.send();
        var response = JSON.parse(xhttp.responseText);
        var data = new Array();
        console.log(response.items);
        Object.entries(response.items).forEach((item)=>{
          const [key, value] = item;
          data.push(value.drugName);
        });
        callback(data);
    variable: medList
c:
    operation: loop
    type: variable
    variable: medList
    subscript: medListLoop
d:
    operation: loop
    type: variable
    variable: drugListUrls
    subscript: drugDetailLoop
e:
    operation: dumpstack
    targetdir: test-dir
subscripts:
    medListLoop:
        a:
            operation: execute_js
            javascriptOperator: |
                var callback = arguments[arguments.length - 1];
                var url = 'https://www.bcbsms.com/BlueLand/rx/rxDirectFormularyDrugSearch.do?method=search&memberId=&drugName={variable}';
                xhttp = new XMLHttpRequest();
                xhttp.open('GET', url, false);
                xhttp.send();
                var response = JSON.parse(xhttp.responseText);
                var data = new Array();
                console.log(response.items);
                Object.entries(response.items).forEach((item)=>{
                    const [key, value] = item;
                    for(i=1; i<=4; i++){
                        if(value['drugDescCat'+i] !== ""){
                            var url = 'https://www.bcbsms.com/BlueLand/rx/rxDirectFormularySimilarDrugSearch.do?method=searchSimilarDrugs&memberId=&drugName='+value['drugDescCat'+i]+'&gpi='+value['drugGpiCat'+i];
                            data.push(url);
                        }
                    }
                });
                callback(data);
            variable: drugListUrls
            replace: medList
    drugDetailLoop:
        a:
            operation: restore
            url: '{drugListUrls}'
        b:
            operation: loadpage
        c:
            operation: injectelement
            selector: xpath
            name: //div[@class="rxFullFormularySimilarDrugsDialog"]
            tag: brandElement
            value: '{drugListUrls}'
        d:
            operation: snapshot